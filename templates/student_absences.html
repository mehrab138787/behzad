<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>غیبت دانش‌آموزان</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Vazirmatn', Tahoma, sans-serif; background: #f0f2f5; }
h2 { font-weight: 700; margin-bottom: 20px; text-align: center; }
.card { border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); margin-bottom: 12px; transition: 0.3s; }
.card:hover { transform: scale(1.02); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }
.accordion-button { font-weight: 600; }
.absence-item { padding: 6px 0; border-bottom: 1px solid #eee; }
.no-absence { color: #888; font-style: italic; padding: 6px 0; }
.form-control, .btn { border-radius: 10px; }
</style>
</head>
<body dir="rtl">

<div class="container mt-4">
    <h2>📋 جستجوی غیبت دانش‌آموزان</h2>

    <!-- فرم جستجو -->
    <form method="POST" class="mb-4">
        <div class="row g-2">
            <div class="col-md-5">
                <input type="text" name="search" class="form-control" placeholder="نام یا نام خانوادگی دانش‌آموز..." value="{{ search_query }}">
            </div>
            <div class="col-md-5">
                <input type="text" name="class_name" class="form-control" placeholder="نام کلاس..." value="{{ class_query }}">
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100">🔍 جستجو</button>
            </div>
        </div>
    </form>

    {% if student_attendance_list %}
    <div class="accordion" id="studentsAccordion">
        {% for entry in student_attendance_list %}
        {% set student = entry.student %}
        {% set attendances = entry.attendances %}
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading{{ student.id }}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ student.id }}" aria-expanded="false" aria-controls="collapse{{ student.id }}">
                    {{ student.firstname }} {{ student.lastname }} - کلاس: {{ student.class_.name }} - تعداد غیبت‌ها: {{ attendances|length }}
                </button>
            </h2>
            <div id="collapse{{ student.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ student.id }}" data-bs-parent="#studentsAccordion">
                <div class="accordion-body">
                    {% if attendances %}
                        {% for att in attendances %}
                        <div class="absence-item">
                            تاریخ: {{ att.date|to_jalali }} - ساعت: {{ att.time.strftime('%H:%M') }}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="no-absence">هیچ غیبتی ثبت نشده است.</div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% elif search_query or class_query %}
        <p class="text-center text-muted">هیچ دانش‌آموزی با این مشخصات پیدا نشد.</p>
    {% endif %}

    <div class="mt-4 text-center">
        <a href="/" class="btn btn-warning">⬅ بازگشت به صفحه اصلی</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
